@model CrmTechTitans.Models.Member


@{
	ViewData["Title"] = "Member Details";
}

<div class="main-content">
	<header class="page-header-details">
		<h1>Member Details</h1>
		<p class="text-muted">Below is the detailed information of the selected member.</p>
	</header>

	<div class="member-card-details">
		<div class="member-card-header-details">
			<div class="member-avatar">
		   @{
        if (Model.MemberPhoto?.Content != null)
        {
            @:<div class="member-photo">
                string imageBase64 = Convert.ToBase64String(Model.MemberPhoto.Content);
                string imageSrc = string.Format("data:" + Model.MemberPhoto.MimeType + ";base64,{0}", imageBase64);
                <img src="@imageSrc" alt="Profile Picture of @Model.MemberName" title="Profile Picture of @Model.MemberName" class="img-fluid rounded" />
            @:</div><hr />
					}
					else
					{
						<i class="fas fa-user"></i>
					}
				}
				
			</div>
			
			<div class="member-info">
				<h2 class="member-name">@Model.MemberName</h2>
		 
				<p class="member-type">
					Membership Types: 
					@if (Model.MemberMembershipTypes.Any())
					{
						@string.Join(", ", Model.MemberMembershipTypes.Select(mmt => mmt.MembershipType.Name))
					}
					else
					{
						<span>No Membership Type Assigned</span>
					}
				</p>

			</div>
		</div>
		<div class="member-card-content">
			<!-- Existing member details -->
			<div class="member-detail">
				<i class="fas fa-user-tie"></i>
				<span>
					<strong>Contact Person:</strong>
					@Html.DisplayFor(model => model.ContactedBy)
				</span>
			</div>
			<!-- Industries Section -->
			<div class="member-detail">
				<i class="fas fa-industry"></i>
				<span>
					<strong>Industries:</strong>
					@if (Model.IndustryMembers.Any())
					{
						<ul>
							@foreach (var memberIndustry in Model.IndustryMembers)
							{
								if (memberIndustry.Industry != null)
								{
									<li>
										@memberIndustry.Industry.Name (NAICS: @memberIndustry.Industry.NAICS)
									</li>
								}
							}
						</ul>
					}
					else
					{
						<span>No industries associated</span>
					}
				</span>
			</div>
			<div class="member-detail">
				<i class="fas fa-building"></i>
				<span>
					<strong>Company Size:</strong>
					@Html.DisplayFor(model => model.CompanySize)
				</span>
			</div>
			<div class="member-detail">
				<i class="fas fa-globe"></i>
				<span>
					<strong>Website:</strong>
					<a href="@Model.CompanyWebsite" target="_blank" rel="noopener noreferrer" class="web-link">
						@Html.DisplayFor(model => model.CompanyWebsite)
					</a>
				</span>
			</div>
			<div class="member-detail">
				<i class="fas fa-calendar-alt"></i>
				<span>
					<strong>Member Since:</strong>
					@Model.MemberSince.ToString("yyyy-MM-dd")
				</span>
			</div>
			<div class="member-detail">
				<i class="fas fa-phone"></i>
				<span>
					<strong>Last Contact Date:</strong>
					@(Model.LastContactDate.HasValue ? Model.LastContactDate.Value.ToString("yyyy-MM-dd") : "N/A")
				</span>
			</div>

			<div class="member-detail">
				<i class="fas fa-sticky-note"></i>
				<span>
					<strong>Notes:</strong>
					@Html.DisplayFor(model => model.Notes)
				</span>
			</div>
			<div class="member-detail">
				<i class="fas fa-check-circle"></i>
				<span>
					<strong>Membership Status:</strong>
					@Html.DisplayFor(model => model.MembershipStatus)
				</span>
			</div>
			<div class="member-detail">
				<i class="fas fa-map-marker-alt"></i>
				<span>
					<strong>Address:</strong>
					@if (Model.MemberAddresses.Any())
					{
						<ul>
							@foreach (var memberAddress in Model.MemberAddresses)
							{
								if (memberAddress.Address != null)
								{
									<li>@memberAddress.Address.Summary</li>
								}
							}
						</ul>
					}
					else
					{
						<span>No address associated</span>
					}
				</span>
			</div>

			<!-- Contacts Section -->
			<div class="member-detail">
				<i class="fas fa-address-book"></i>
				<span>
					<strong>Contacts:</strong>
					@if (Model.MemberContacts.Any())
					{
						<ul>
							@foreach (var memberContact in Model.MemberContacts)
							{
								if (memberContact.Contact != null)
								{
									<li>
										<strong>@memberContact.ContactType:</strong>
										@memberContact.Contact.FullFormalName
										@if (!string.IsNullOrEmpty(memberContact.Contact.Email))
										{
											<span> | <a href="mailto:@memberContact.Contact.Email">@memberContact.Contact.Email</a></span>
										}
										@if (!string.IsNullOrEmpty(memberContact.Contact.Phone))
										{
											<span> | <a href="tel:@memberContact.Contact.Phone">@memberContact.Contact.Phone</a></span>
										}
									</li>
								}
							}
						</ul>
					}
					else
					{
						<span>No contacts associated</span>
					}
				</span>
			</div>
		</div>
		<div class="member-card-footer">
			<a asp-action="Edit" asp-route-id="@Model?.ID" class="button-1">
				<i class="fas fa-edit"></i> Edit
			</a>
			<a asp-action="Index" class="button-2">
				<i class="fas fa-arrow-left"></i> Back to Members
			</a>
		</div>
	</div>
</div>